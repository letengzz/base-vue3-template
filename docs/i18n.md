# 国际化 (i18n)

## 概述

本项目使用 Vue I18n 11 作为国际化解决方案，支持多语言切换，包括中文（zh-CN）和英文（en-US）两种语言。配置文件位于 src/i18n 目录下。

## 目录结构

```
src/i18n/
├── index.ts              # i18n 实例创建和配置（支持动态加载）
└── locales/
    ├── zh-CN.ts          # 中文语言包
    ├── en-US.ts          # 英文语言包
    └── modules/          # 模块化语言包
        ├── zh-CN/
        │   └── demo.ts   # 示例模块中文翻译
        └── en-US/
            └── demo.ts   # 示例模块英文翻译
```

## 配置说明

### 初始化 i18n

```typescript
// src/i18n/index.ts
import type { App } from 'vue'
import { createI18n } from 'vue-i18n'

const getBrowserLanguage = () => {
  const browserLang = navigator.language || (navigator as any).userLanguage
  return ['zh-CN', 'en-US'].includes(browserLang) ? browserLang : 'zh-CN'
}

const currentLang = localStorage.getItem('locale') || getBrowserLanguage()

const i18n = createI18n({
  legacy: false,
  locale: currentLang,
  fallbackLocale: 'zh-CN',
  messages: {},
})

export async function loadLanguage(lang: string) {
  const messages = await import(`./locales/${lang}.ts`).then((messages) => {
    i18n.global.setLocaleMessage(lang, messages.default)
    localStorage.setItem('locale', lang)
    return lang
  })
  return messages
}

loadLanguage(currentLang)

export const useI18n = (app: App) => {
  app.use(i18n)
}

export default i18n
```

### 动态加载语言包

本项目支持动态加载语言包，实现按需加载以优化应用体积：

```typescript
import { loadLanguage } from '@/i18n'

// 异步加载并切换语言
await loadLanguage('zh-CN')
await loadLanguage('en-US')
```

语言包会在首次使用时自动加载并缓存，同时会自动保存用户选择到 `localStorage`，页面刷新后会自动恢复用户选择的语言。

### 在应用入口注册

```typescript
// src/main.ts
import { createApp } from 'vue'
import App from './App.vue'
import { useI18n } from './i18n'

const app = createApp(App)
useI18n(app)
app.mount('#app')
```

## 语言包结构

### 中文语言包 (zh-CN.ts)

```typescript
// src/i18n/locales/zh-CN.ts
export default {
  common: {
    hello: '你好',
    welcome: '欢迎，{name}!',
  },
  home: {
    title: '欢迎使用 Vue3 通用模板',
    description: '这是一个功能完善、易于扩展的 Vue3 通用模板项目',
  },
}
```

### 英文语言包 (en-US.ts)

```typescript
// src/i18n/locales/en-US.ts
export default {
  common: {
    welcome: 'Welcome, {name}!',
  },
  home: {
    title: 'Welcome to Vue3 Common Template',
    description: 'This is a feature-rich, easy-to-extend Vue3 common template project',
  },
}
```

### 模块化语言包

对于大型项目，可以将翻译按模块拆分到 `locales/modules/` 目录下：

```typescript
// src/i18n/locales/modules/zh-CN/demo.ts
export default {
  title: '示例页面',
  info: '这是一个示例页面',
}

// src/i18n/locales/modules/en-US/demo.ts
export default {
  title: 'Demo Page',
  info: 'This is a demo page',
}
```

## 在模板中使用

### 基本用法

```vue
<template>
  <div class="home">
    <h1>{{ $t('home.title') }}</h1>
    <p>{{ $t('home.description') }}</p>
    <p>{{ $t('common.hello') }}</p>
  </div>
</template>
```

### 带参数的消息

```vue
<template>
  <div>
    <!-- 输出: 欢迎，张三! -->
    <p>{{ $t('common.welcome', { name: '张三' }) }}</p>
  </div>
</template>
```

### 在 v-bind 中使用

```vue
<template>
  <input :placeholder="$t('form.username')" />
  <button :title="$t('button.submit')">提交</button>
</template>
```

## 在脚本中使用

```vue
<script setup lang="ts">
import { useI18n } from 'vue-i18n'

const { t } = useI18n()

// 翻译单个键
const title = t('home.title')

// 带参数的翻译
const welcome = t('common.welcome', { name: '张三' })
</script>
```

## 切换语言

```vue
<template>
  <div class="language-switcher">
    <button
      v-for="lang in languages"
      :key="lang.value"
      :class="{ active: currentLocale === lang.value }"
      @click="onChangeLanguage(lang.value)"
    >
      {{ lang.label }}
    </button>
  </div>
</template>

<script setup lang="ts">
import { loadLanguage } from '@/i18n'
import { useI18n } from 'vue-i18n'

const { locale } = useI18n()
const currentLocale = locale

const languages = [
  { label: '中文', value: 'zh-CN' },
  { label: 'English', value: 'en-US' },
]

const onChangeLanguage = async (lang: string) => {
  await loadLanguage(lang)
  locale.value = lang
}
</script>
```

> **注意**：仅修改 `locale.value` 只会切换界面语言，但不会加载对应的语言包。如果语言包尚未加载，请使用 `loadLanguage` 函数。

## 添加新语言

### 1. 创建语言文件

在 `src/i18n/locales/` 目录下创建新的语言文件：

```typescript
// src/i18n/locales/ja-JP.ts
export default {
  common: {
    hello: 'こんにちは',
    welcome: 'ようこそ、{name}!',
  },
  home: {
    title: 'Vue3 共通テンプレートへようこそ',
    description: 'これは機能が豊富で拡張しやすい Vue3 共通テンプレートプロジェクトです',
  },
}
```

### 2. 更新支持的语言列表

在 `src/i18n/index.ts` 中更新 `getBrowserLanguage` 函数：

```typescript
const getBrowserLanguage = () => {
  const browserLang = navigator.language || (navigator as any).userLanguage
  return ['zh-CN', 'en-US', 'ja-JP'].includes(browserLang) ? browserLang : 'zh-CN'
}
```

## 最佳实践

### 1. 统一组织语言包

```typescript
// 推荐：按模块组织
export default {
  common: {
    /* 通用翻译 */
  },
  home: {
    /* 首页翻译 */
  },
  user: {
    /* 用户模块翻译 */
  },
  settings: {
    /* 设置模块翻译 */
  },
}
```

### 2. 使用占位符而非字符串拼接

```vue
<!-- 推荐 -->
<p>{{ $t('welcome.message', { name: userName }) }}</p>

<!-- 不推荐 -->
<p>{{ $t('welcome.message') + ' ' + userName }}</p>
```

### 3. 保持键名一致性

```typescript
// 推荐：使用 camelCase
export default {
  form: {
    username: '用户名',
    password: '密码',
  },
}
```
